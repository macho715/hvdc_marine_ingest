<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Minimal Test - WMS + Basemap</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>html,body,#map{height:100%;margin:0}</style>
</head>
<body>
<div id="map"></div>
<div style="position:absolute;top:10px;right:10px;background:white;padding:10px;border-radius:5px;z-index:1000">
  <div id="status">ë¡œë”© ì¤‘...</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>
<script>
const status = document.getElementById('status');
const log = (msg) => { 
  console.log(msg); 
  status.innerHTML += '<br>' + msg; 
};

log('âœ… Leaflet ë¡œë“œ ì™„ë£Œ');
log('âœ… Esri-Leaflet ë¡œë“œ ì™„ë£Œ');

const map = L.map('map').setView([24.843833, 53.655306], 7);
log('âœ… Map ì´ˆê¸°í™” ì™„ë£Œ');

// OSM ë°±ì—…
const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom: 12
});

// Esri Oceans ì‹œë„
let oceans;
try {
  oceans = L.esri.basemapLayer('Oceans').addTo(map);
  log('âœ… Esri Oceans ì¶”ê°€ ì‹œë„');
  
  oceans.on('tileerror', (e) => {
    log('âš ï¸ Esri íƒ€ì¼ ì—ëŸ¬ ë°œìƒ â†’ OSM í´ë°±');
    if (map.hasLayer(oceans)) map.removeLayer(oceans);
    if (!map.hasLayer(osm)) osm.addTo(map);
  });
  
  oceans.on('tileload', () => {
    log('âœ… Esri íƒ€ì¼ ë¡œë“œ ì„±ê³µ');
  });
} catch(e) {
  log('âŒ Esri ì—ëŸ¬: ' + e.message);
  osm.addTo(map);
}

// WMS í…ŒìŠ¤íŠ¸
log('ğŸŒŠ WMS ë ˆì´ì–´ ì¶”ê°€ ì¤‘...');
const wmsUrl = 'https://pae-paha.pacioos.hawaii.edu/erddap/wms/ww3_global/request';
const wmsLayer = 'ww3_global:whgt';

const wms = L.tileLayer.wms(wmsUrl, {
  layers: wmsLayer,
  format: 'image/png',
  transparent: true,
  opacity: 0.80,
  COLORSCALERANGE: '0,2.5',
  NUMCOLORBANDS: 40,
  PALETTE: 'Rainbow'
}).addTo(map);

wms.on('load', () => log('âœ… WMS ë¡œë“œ ì™„ë£Œ'));
wms.on('tileerror', (e) => log('âŒ WMS íƒ€ì¼ ì—ëŸ¬: ' + e.error));

// ë§ˆì»¤
L.marker([24.843833, 53.655306]).addTo(map)
  .bindPopup('AGI - Al Ghallan Island').openPopup();
log('âœ… ë§ˆì»¤ ì¶”ê°€ ì™„ë£Œ');

// 2ì´ˆ í›„ ìµœì¢… ìƒíƒœ
setTimeout(() => {
  log('');
  log('=== ìµœì¢… ìƒíƒœ ===');
  log('ë² ì´ìŠ¤ë§µ: ' + (map.hasLayer(oceans) ? 'Esri Oceans' : 'OSM'));
  log('WMS ë ˆì´ì–´: ' + (map.hasLayer(wms) ? 'í™œì„±' : 'ë¹„í™œì„±'));
}, 2000);
</script>
</body>
</html>

