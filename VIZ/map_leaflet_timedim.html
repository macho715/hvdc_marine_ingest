<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marine Viz — TimeDimension + WMS(WW3) + Wind Arrows</title>
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Esri-Leaflet (Oceans basemap) -->
  <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>

  <!-- TimeDimension -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.0/dist/leaflet.timedimension.control.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.0/dist/leaflet.timedimension.min.js"></script>

  <style>
    :root{
      /* 3단 팔레트(cmocean 'thermal' 느낌) for wind arrows */
      --cmo-low:  #2c7fb8; /* low */
      --cmo-mid:  #fdae61; /* mid */
      --cmo-high: #d7191c; /* high */
    }
    html,body,#map{height:100%;margin:0;background:#f3f4f6}
    .legend{
      position:absolute;bottom:12px;left:12px;background:#fff;padding:8px 10px;border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,.15);font:12px/1.45 system-ui,Segoe UI,Arial
    }
    .legend .sw{display:inline-block;width:10px;height:10px;border-radius:2px;margin-right:6px;vertical-align:middle}
    code{background:#f6f8fa;padding:0 4px;border-radius:4px}
  </style>
</head>
<body>
<div id="map"></div>

<!-- Inline GeoJSON for wind vectors (one timestamp). Replace with adapter output if available. -->
<script id="wind-data" type="application/json">
{"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.888878]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.672283,24.886161]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.687213,24.87834]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.698294,24.866356]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.704191,24.851655]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.704191,24.836011]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.698294,24.82131]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.687213,24.809326]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.672283,24.801505]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.798788]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.638329,24.801505]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.623399,24.809326]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.612318,24.82131]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.606421,24.836011]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.606421,24.851655]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.612318,24.866356]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.623399,24.87834]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.638329,24.886161]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.933923]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.689261,24.92849]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.71912,24.912846]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.741283,24.888878]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.753075,24.859477]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.753075,24.828189]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.741283,24.798788]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.71912,24.77482]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.689261,24.759176]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.753743]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.621351,24.759176]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.591492,24.77482]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.569329,24.798788]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.557537,24.828189]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.557537,24.859477]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.569329,24.888878]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.591492,24.912846]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.621351,24.92849]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.978968]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.706238,24.970818]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.751028,24.947353]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.784271,24.911401]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.80196,24.867299]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.80196,24.820367]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.784271,24.776265]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.751028,24.740313]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.706238,24.716848]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.708698]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.604374,24.716848]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.559584,24.740313]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.526341,24.776265]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.508652,24.820367]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.508652,24.867299]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.526341,24.911401]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.559584,24.947353]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.604374,24.970818]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,25.024013]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.723216,25.013147]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.782935,24.981859]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.82726,24.933923]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.850845,24.875121]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.850845,24.812545]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.82726,24.753743]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.782935,24.705807]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.723216,24.674519]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.663653]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.587396,24.674519]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.527677,24.705807]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.483352,24.753743]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.459767,24.812545]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.459767,24.875121]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.483352,24.933923]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.527677,24.981859]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.587396,25.013147]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,25.069058]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.740193,25.055475]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.814842,25.016366]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.870248,24.956446]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.899729,24.882943]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.899729,24.804723]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.870248,24.73122]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.814842,24.6713]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.740193,24.632191]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.618608]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.570419,24.632191]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.49577,24.6713]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.440364,24.73122]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.410883,24.804723]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.410883,24.882943]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.440364,24.956446]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.49577,25.016366]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.570419,25.055475]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,25.114103]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.757171,25.097804]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.846749,25.050872]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.913237,24.978968]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.948614,24.890765]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.948614,24.796901]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.913237,24.708698]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.846749,24.636794]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.757171,24.589862]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.655306,24.573563]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.553441,24.589862]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.463863,24.636794]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.397375,24.708698]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.361998,24.796901]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.361998,24.890765]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.397375,24.978968]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.463863,25.050872]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}},{"type":"Feature","geometry":{"type":"Point","coordinates":[53.553441,25.097804]},"properties":{"time":"2025-10-08T17:00:00Z","wind_speed_ms":14.9,"wind_dir_deg":352.0,"u_ms":2.074,"v_ms":-14.755,"wave_height_m":0.24,"wave_dir_deg":349.0,"wave_period_s":2.8}}]}
</script>

<div class="legend">
  <div><b>Layers</b></div>
  <div>• Hs (WW3 WMS + TimeDimension)</div>
  <div>• Wind vectors (u/v arrows)</div>
  <div style="margin-top:6px"><b>Palette (arrows, kt)</b></div>
  <div><span class="sw" style="background:var(--cmo-low)"></span>&lt; 10</div>
  <div><span class="sw" style="background:var(--cmo-mid)"></span>10–20</div>
  <div><span class="sw" style="background:var(--cmo-high)"></span>&ge; 20</div>
  <div style="margin-top:6px">Hs range: <code>0–2.5 m</code></div>
</div>

<script>
(function(){
  const CENTER=[24.843833,53.655306]; // AGI
  const WMS_URL   = "https://erddap.aoml.noaa.gov/hdb/erddap/wms/WaveWatch_2021/request";
  const WMS_LAYER = "WaveWatch_2021:whgt"; // significant wave height (wind waves)

  // 1) Map + TimeDimension
  const map = L.map('map', {
    center: CENTER, zoom: 7,
    timeDimension: true,
    timeDimensionControl: true,
    timeDimensionOptions: {
      // 최근 72시간을 1시간 간격으로
      timeInterval: new Date(Date.now()-72*3600*1000).toISOString() + "/" + new Date().toISOString(),
      period: "PT1H"
    },
    timeDimensionControlOptions: {
      position: "bottomleft",
      playerOptions: { transitionTime: 500, loop: true, startOver: true },
      autoPlay: false,
      speedSlider: true,
      timeSliderDragUpdate: true
    }
  });

  // Basemap: Esri Oceans (fallback OSM)
  try {
    L.esri.basemapLayer('Oceans').addTo(map);
  } catch (e) {
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:12}).addTo(map);
  }

  // 2) WW3 WMS with palette + color range
  const wmsBase = L.tileLayer.wms(WMS_URL, {
    layers: WMS_LAYER,
    format: "image/png",
    transparent: true,
    opacity: 0.72,
    // Common ncWMS/ERDDAP extras (server may ignore some):
    COLORSCALERANGE: "0,2.5",
    NUMCOLORBANDS: 40,
    PALETTE: "Rainbow"
    // If your ERDDAP supports cmocean via ncWMS styles, set PALETTE accordingly (e.g., 'cmocean/thermal').
  });
  // Bind WMS to TimeDimension (auto adds &time=...)
  const tdWms = L.timeDimension.layer.wms(wmsBase, {
    updateTimeDimension: true,
    requestTimeFromCapabilities: true,
    cache: 24
  }).addTo(map);

  // 3) Wind arrows (pixel-length, zoom-safe)
  const gj = JSON.parse(document.getElementById('wind-data').textContent || "{}");
  const group = L.layerGroup().addTo(map);
  const RAD = Math.PI/180;
  const PX_PER_KT = 0.9, MIN=6, MAX=28;
  function colorFor(spd_kt){
    if (spd_kt < 10) return getCSS('--cmo-low');
    if (spd_kt < 20) return getCSS('--cmo-mid');
    return getCSS('--cmo-high');
  }
  function getCSS(name){
    return getComputedStyle(document.documentElement).getPropertyValue(name) || '#1F77B4';
  }
  function renderArrows(){
    group.clearLayers();
    if(!gj || !gj.features) return;
    for(const f of gj.features){
      const lon=f.geometry.coordinates[0], lat=f.geometry.coordinates[1];
      const u=f.properties.u_ms||0, v=f.properties.v_ms||0;
      const spd_ms=Math.hypot(u,v); if(spd_ms<0.1) continue;
      const spd_kt=spd_ms*1.94384;
      let Lpx=Math.min(MAX, Math.max(MIN, PX_PER_KT*spd_kt));
      const start = map.latLngToLayerPoint([lat,lon]);
      const unitX =  u/spd_ms;
      const unitY = -v/spd_ms; // y down
      const endPt = L.point(start.x + Lpx*unitX, start.y + Lpx*unitY);
      const endLL = map.layerPointToLatLng(endPt);
      const col = colorFor(spd_kt);
      L.polyline([[lat,lon], endLL], {color: col, weight:1.7, opacity:0.9}).addTo(group);
      const back = L.point(start.x + 0.7*(endPt.x-start.x), start.y + 0.7*(endPt.y-start.y));
      const ortho= L.point(-(endPt.y-start.y), (endPt.x-start.x));
      const t1 = map.layerPointToLatLng(L.point(back.x + 0.12*ortho.x, back.y + 0.12*ortho.y));
      const t2 = map.layerPointToLatLng(L.point(back.x - 0.12*ortho.x, back.y - 0.12*ortho.y));
      L.polyline([t1, endLL, t2], {color: col, weight:1.1, opacity:0.9}).addTo(group);
    }
  }
  renderArrows();
  map.on('zoomend moveend', renderArrows);
})();
</script>
</body>
</html>
